| ID      | User Story / Feature                                                                               | Category                      | Requirement (NFR)                                                                                                                    | Rationale / Risk                                            | Acceptance (G-W-T)                                                                                                    | Evidence (test/log/scan/policy)                                 |   Trace (issue/link) | Owner             | Status   | Priority    | Severity      | Tags                           |
|:--------|:---------------------------------------------------------------------------------------------------|:------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------|:------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------|---------------------:|:------------------|:---------|:------------|:--------------|:-------------------------------|
| NFR-001 | Как гость, я хочу зарегистрировать учётную запись, чтобы получить доступ к функционалу приложения. | Security-AuthN                | Токен подтверждения e-mail действителен ≤ 90 минут; попытки подтверждения без/с неверным токеном возвращают 401.                     | Базовая линия безопасности.                                 | Given истёкший или некорректный токен подтверждения                                                                   | integration test: auth-verify-expired; contract: RFC7807 sample |                  nan | Backend-developer | Draft    | P1 - High   | S2 - Major    | authn,verification,ttl         |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | When POST /api/auth/verify-email                                                                                      |                                                                 |                      |                   |          |             |               |                                |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | Then 401 в формате RFC 7807 (application/problem+json) без стэктрейсов                                                |                                                                 |                      |                   |          |             |               |                                |
| NFR-002 | Как гость, я хочу зарегистрировать учётную запись, чтобы получить доступ к функционалу приложения. | Security-InputValidation      | Body JSON для /api/auth/register ≤ 16 KiB; только разрешённые поля (email, password, name, age, address, sex); extra-поля запрещены. | защита от грязного ввода и DoS через большие payload.       | Given тело 32 KiB и неизвестные поля                                                                                  | e2e: register-validate; schema policy (DTO)                     |                  nan | Backend-developer | Draft    | P1 - High   | S2 - Major    | validation,limits,dto          |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | When POST /api/auth/register                                                                                          |                                                                 |                      |                   |          |             |               |                                |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | Then 413 (oversize) или 400 (extra fields) в RFC 7807                                                                 |                                                                 |                      |                   |          |             |               |                                |
| NFR-003 | Как гость, я хочу зарегистрировать учётную запись, чтобы получить доступ к функционалу приложения. | RateLimiting                  | Лимит на /api/auth/register: ≤ 5 req/min per IP; превышение → 429 + корректный Retry-After.                                          | защита от ботов и DoS массовой регистрации                  | Given активный токен                                                                                                  | e2e: rate-limit-register; gateway config snapshot               |                  nan | Backend-developer | Draft    | P1 - High   | S2 - Major    | dos,abuse,throttling           |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | When выполняется 10 запросов регистрации за 60 секунд к POST /api/auth/register                                       |                                                                 |                      |                   |          |             |               |                                |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | Then как минимум 2 ответа = 429 и заголовок Retry-After                                                               |                                                                 |                      |                   |          |             |               |                                |
| NFR-004 | Как гость, я хочу зарегистрировать учётную запись, чтобы получить доступ к функционалу приложения. | API-Contract/Errors (RFC7807) | Все ошибки /api/auth/register и /api/auth/verify-email возвращаются в формате RFC 7807; стэктрейсы скрыты                            | предсказуемость и безопасность                              | Given внутренняя ошибка при POST /api/auth/register                                                                   | contract test: rfc7807-errors; log sample with correlation_id   |                  nan | Backend-developer | Draft    | P2 - Medium | S2 - Major    | errors,rfc7807,logging         |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | When клиент получает ответ                                                                                            |                                                                 |                      |                   |          |             |               |                                |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | Then Content-Type=application/problem+json; присутствуют type, title, status, detail, correlation_id; стэктрейсов нет |                                                                 |                      |                   |          |             |               |                                |
| NFR-005 | Как гость, я хочу зарегистрировать учётную запись, чтобы получить доступ к функционалу приложения. | Privacy/PII                   | PII (email, name, password) не логируется в открытом виде; raw PII retention ≤ 30 дней.                                              | приватность и соответствие требованиям защиты данных.       | Given обработка DTO регистрации                                                                                       | log pattern examples; retention policy excerpt                  |                  nan | Backend-developer | Draft    | P2 - Medium | S2 - Major    | privacy,pii,retention          |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | When сервис пишет логи и хранилище                                                                                    |                                                                 |                      |                   |          |             |               |                                |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | Then PII поля маскированы/исключены в логах; политика ретенции ≤ 30d зафиксирована                                    |                                                                 |                      |                   |          |             |               |                                |
| NFR-006 | Как покупатель, я хочу оформить заказ и оплатить его, чтобы получить товар/услугу.                 | Security-AuthZ/RBAC           | Пользователь tenant=A не может читать/изменять ресурсы tenant=B; попытки → 403/404 без утечки данных.                                | изоляция данных и наименьшие привилегии.                    | Given пользователь из tenant A без нужной роли                                                                        | e2e: rbac-tenant-isolation; policy snippet                      |                  nan | Backend-developer | Draft    | P1 - High   | S1 - Critical | rbac,tenant,authorization      |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | When GET /api/orders/{id} принадлежащий tenant B                                                                      |                                                                 |                      |                   |          |             |               |                                |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | Then ответ 404 (или 403 по политике), без утечки идентификаторов                                                      |                                                                 |                      |                   |          |             |               |                                |
| NFR-007 | Как покупатель, я хочу оформить заказ и оплатить его, чтобы получить товар/услугу.                 | Data-Integrity                | Все записи заказа/платежа выполняются только параметризованными запросами; значения канонизируются (UTC datetime, Decimal).          | защита от инъекций и несогласованности данных.              | Given нестандартные вводные данные                                                                                    | ORM config; unit: dao-parameterized; migration notes            |                  nan | Backend-developer | Draft    | P1 - High   | S2 - Major    | sql,orm,canonicalization       |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | When создаётся заказ и платеж                                                                                         |                                                                 |                      |                   |          |             |               |                                |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | Then используется параметризация; данные в БД в канонической форме (UTC/Decimal)                                      |                                                                 |                      |                   |          |             |               |                                |
| NFR-008 | Как покупатель, я хочу оформить заказ и оплатить его, чтобы получить товар/услугу.                 | Auditability                  | Админ/критические операции с заказами и платежами создают audit-событие (actor, action, target, time, result); журнал неизменяем.    | соответствие политикам, расследование инцидентов.           | Given администратор отменяет заказ                                                                                    | audit log example; retention/immutability policy                |                  nan | Backend-developer | Draft    | P2 - Medium | S2 - Major    | audit,compliance,logging       |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | When операция завершена                                                                                               |                                                                 |                      |                   |          |             |               |                                |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | Then создаётся audit-запись с actor/action/target/time/result; запись неизменяема                                     |                                                                 |                      |                   |          |             |               |                                |
| NFR-009 | Как покупатель, я хочу оформить заказ и оплатить его, чтобы получить товар/услугу.                 | Timeouts/Retry/CircuitBreaker | Вызовы внешнего платежного провайдера: timeout ≤ 2s; retries ≤ 3 с джиттером; CB при error-rate ≥50% за 1 минуту.                    | устойчивость к зависимостям и деградациям внешнего сервиса. | Given недоступность платежного провайдера                                                                             | integration: payment-timeouts; service config excerpt; CB logs  |                  nan | Backend-developer | Draft    | P1 - High   | S2 - Major    | timeouts,retry,circuit-breaker |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | When создаётся платежная сессия                                                                                       |                                                                 |                      |                   |          |             |               |                                |
|         |                                                                                                    |                               |                                                                                                                                      |                                                             | Then суммарное ожидание ≤ 6s; не более 3 retry с джиттером; circuit breaker активируется при пороге                   |                                                                 |                      |                   |          |             |               |                                |