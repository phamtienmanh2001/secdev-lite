# S04 - Risk Scoring (матрица)

| Risk ID | Source (DFD/Row) | Consolidated Description | Threat (S/T/R/I/D/E) | NFR link (ID) | L (1-5) | Rationale-L |   I (1-5) | Rationale-I | Score (=L×I) | Decision (Top-5?) | ADR |
|:----------|:-------------------|:---------------------------------------------------------------|:-----------------------|:-----------------|----------:|:---------------------------------------|----------:|:----------------------------------|---------------:|:--------------------|:--------------------------------------------|
| R-01 | Edge Internet→API  | Повторное использование токенов / подмена на публичном периметре | S | NFR-001 | 4 | Публичная поверхность/типовой сценарий | 4 | Существенный ущерб/утечка/простой | 16 | Yes | JWT TTL + Refresh + Rotation |
| R-02 | Edge Internet→API  | Грязный ввод: extra поля, oversize payload, несоответствие схеме | T | NFR-002, NFR-004 | 3 | Средняя вероятность | 4 | Существенный ущерб/утечка/простой | 12 | Yes | Input Validation & Size Limits; reject extra fields |
| R-03 | Internet→API | Злоупотребление частотой запросов, brute-force/регистрация. | D | NFR-003 | 4 | Публичная поверхность/типовой сценарий | 4 | Существенный ущерб/утечка/простой | 16 | Yes | Rate Limiting (≤5 req/min/IP) + 429 + Retry-After |
| R-04 | Service / Logs | PII в логах/ошибках, чрезмерные детали | I | NFR-005 | 3 | Средняя вероятность | 4 | Существенный ущерб/утечка/простой | 12 | | PII masking in logs + retention ≤30d |
| R-05 | RBAC / Tenant | Обход ролей/межтенантная утечка | E | NFR-006 | 4 | Публичная поверхность/типовой сценарий | 5 | Существенный ущерб/утечка/простой | 20 | Yes | RBAC + Tenant Isolation (deny-by-default) |
| R-06 | Service→DB | Инъекции/неканоничные значения при записи | T | NFR-007 | 3 | Средняя вероятность | 4 | Существенный ущерб/утечка/простой | 12 | | DB Safety: parameterized queries + canonicalization |
| R-07 | Admin actions | Нет неизменяемого журнала критических операций | R | NFR-008 | 3 | Средняя вероятность | 3 | Умеренный ущерб | 9 | | Audit Log for Admin Actions |
| R-08 | Service→External | Зависание внешнего API → отказ в обслуживании без таймаута/повтора/схемы Circuit Breaker | D | NFR-009 | 4 | Публичная поверхность/типовой сценарий | 4 | Существенный ущерб/утечка/простой | 16 | Yes | Timeouts ≤2s + Retry≤3 with jitter + Circuit Breaker (50%/1m) |



